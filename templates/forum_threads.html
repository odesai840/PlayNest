{% extends "_layout.html" %}
{% block title %}PlayNest | {{ forum.title }} Threads{% endblock %}

{% block content %}

<style>
    .thread-title:hover {
        text-decoration: underline;
        color: #8be8b5;
    }
</style>

<div class="container mt-4">
    <h2 class="text-center mb-4">{{ forum.title }} Threads</h2>

    <!-- display a message if the user is not logged in -->
    {% if 'username' not in session %}
        <p><a href="{{ url_for('login') }}" class="login-link">Log in</a> to post a new thread.</p>
    {% else %}
        <!-- button to toggle the form visibility -->
        <button id="toggleFormBtn" class="toggleFormBtn"><i class="fas fa-pencil-alt"></i> Post a Thread</button>
    {% endif %}

    <!-- form to add a new thread (initially hidden) -->
    <form id="threadForm" method="POST" style="display: none;">
        <div class="forum-threads-form-container">
            <div class="form-group">
                <label for="title">Thread Title:</label>
                <input type="text" class="form-control" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="content">Thread Content:</label>
                <textarea class="form-control" id="content" name="content" rows="5" required></textarea>
            </div>
            <button type="submit" class="thread-button">Post</button>
        </div>
    </form>

    <!-- display existing threads -->
    {% for thread in forum.threads %}
    <div class="card mb-3">
        <div class="thread-container">
            <div class="card-body d-flex justify-content-between">
                <div class="w-100"> <!-- width 100% to make the text extend from one end to the other -->
                    <a href="{{ thread.detail_url }}">
                        <h5 class="card-title thread-title">{{ thread.title }}</h5>
                    </a>
                    <p class="card-text">{{ thread.content }}</p>
                    <p class="card-details">
                        Posted by: <span style="color: #8be8b5;">{{ thread.user.username }}</span>
                        on {{ thread.created_at.strftime('%m-%d-%Y â€¢ %I:%M %p') }}
                    </p>
                </div>
                {% if 'username' in session and thread.user.username == session['username'] %}
                    <!-- delete button if the thread belongs to the logged-in user -->
                    <form method="POST" action="{{ url_for('delete_thread', forum_slug=forum.slug, thread_id=thread.id) }}">
                        <button type="submit" class="btn btn-link delete-button">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- JavaScript to toggle form visibility -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const toggleFormBtn = document.getElementById('toggleFormBtn');
        const threadForm = document.getElementById('threadForm');

        toggleFormBtn.addEventListener('click', function () {
            if (threadForm.style.display === 'none' || threadForm.style.display === '') {
                threadForm.style.display = 'block';
            } else {
                threadForm.style.display = 'none';
            }
        });
    });
</script>

{% endblock %}